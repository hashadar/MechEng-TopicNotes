%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Lachaise Assignment
% LaTeX Template
% Version 1.0 (26/6/2018)
%
% This template originates from:
% http://www.LaTeXTemplates.com
%
% Authors:
% Marion Lachaise & François Févotte
% Vel (vel@LaTeXTemplates.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass{article}

\input{structure.tex} % Include the file specifying the document structure and custom commands

%----------------------------------------------------------------------------------------
%	ASSIGNMENT INFORMATION
%----------------------------------------------------------------------------------------

\title{Designing a Lap Simulator for the Shell Eco-Marathon\\Intermediate Report} % Title of the assignment

\author{Supervisor: Tim Baker\\Student: Hasha Dar} % Author name and email address

\date{University College London --- \today} % University, school and/or department name(s) and a date

%----------------------------------------------------------------------------------------
\usepackage{listings}
\usepackage{float}
\usepackage{siunitx}
\usepackage{color} %red, green, blue, yellow, cyan, magenta, black, white
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}
\lstset{language=Matlab,%
    %basicstyle=\color{red},
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}

\begin{document}

\maketitle % Print the title

%----------------------------------------------------------------------------------------
%	INTRODUCTION
%----------------------------------------------------------------------------------------
\section{Project Background \& Problem}
The Shell Eco-Marathon is a competition at the school and university level for students focusing on energy optimisation in vehicles. The aim of the competition is to develop new innovations in energy efficiency for vehicles on the road with the idea of reducing carbon emissions \citep{ShellEco2021}. I will be focusing on the 'Prototype' category for the competition, which involves designing a hydrogen-powered single-seater vehicle with a focus on attaining ultra-efficiency through the optimisation of the aerodynamic and performance characteristics of the vehicle.

For an ultra-energy-efficient vehicle, there are many sources of inefficiency. Some of them are aerodynamic drag (air resistance), friction drag (from the road surface) and losses in the powertrain (electricity generation, mechanical losses) \citep{Wei2019}. The design itself of the car must be optimised to increase its performance such as the weight of the vehicle \citep{Tsirogiannis2019}.

A problem that arises when investigating and modelling these variables is that there is no way of testing certain performance characteristics within the holistic context of the competition virtually. Currently, to test newly designed components and its overall impact on the performance of the vehicle, the part must be prototyped and installed on the vehicle, and then experimentally tested. This presents a problem as this is costly, time-consuming and constrains the number of prototypes that can be made.

A transient, dynamic lap simulator will allow the analysis of the vehicle's various performance characteristics. This will allow the team to optimise and prototype designs much more effectively. The team would be able to test the vehicle on the final test track, without the cost of being there physically.
\section{Project Aim}
During the design phase of the vehicle, a lot of work must go into modelling performance variables of the vehicle. This may be done through mathematical analysis and through the use of software such as Computational Fluid Dynamics (CFD) and Finite Element Analysis (FEA). These methods allow us to test whether our design meets our performance criteria (in a virtual sense). This project will focus on bringing together the various performance characteristics of the vehicle to be able to analyse the car in a contextual manner. A lap simulator will allow the team to see how their prototype design will function in a real-world scenario, rather than as a discrete set of performance variables. Hence, with a lap simulator the team will be able to:
\begin{itemize}
	\item unify the various computational models that assess parts of the vehicles performance
	\item see where the primary energy inefficiencies are in a transient, dynamics test, allowing targeted improvement of the vehicle's performance
	\item reduce the number of physical tests for the vehicle,
	      \begin{itemize}
		      \item lowering cost
		      \item reducing development time
		      \item minimising the number of prototype parts manufactured
	      \end{itemize}
\end{itemize}
\section{Methodology}
\begin{enumerate}
	\item Research and select a race track for modelling
	\item Build racetrack analysis code (to find turning angles at any moment)
	\item Research vehicle performance parameters (motor, drivetrain, vehicle)
	\item Integrate vehicle performance parameters into MATLAB model
	\item Integrate vehicle constraints (friction limits, cornering force, electrical power)
	\item Design Simulink model to link performance parameters together
	\item Design motor control loops (dependent on race strategy)
	\item Generate vehicle data (displacement, velocity, acceleration)
	\item Generate lap time for vehicle
	\item Optimise race strategy to improve lap time
	\item Improve fidelity of Simulink model
	\item Develop GUI for simulation
\end{enumerate}
\subsection{Track data and vehicle parameters}
The following MATLAB code takes racetrack racing line coordinate data and turns adjacent points into vectors. The angle between adjacent vectors are then calculated and stored in an array. This gives us the instantaneous racing line track curvature at any point. Next, we see that the performance parameters for the various vehicle subsystems are stored. 
\lstinputlisting{../MCode/model1.m}
Next, a Simulink model was created to model the various performance parameters:
\begin{figure}[H]
	\centering
	\includegraphics[width = \textwidth]{./img/simulink1.jpg}
	\caption{Current Simulink Model.}
\end{figure}
Here we can see that our motor torque (following a traditional DC motor power curve) is inputted into the transmission subsystem:
\begin{figure}[H]
	\centering
	\includegraphics[width = \textwidth]{./img/simulink3.png}
	\caption{Drivetrain model.}
\end{figure}
Here, we see that the drivetrain ratios and efficiency is inputted. This outputs our transmission torque.
\begin{figure}[H]
	\centering
	\includegraphics[width = \textwidth]{./img/simulink4.png}
	\caption{Vehicle model.}
\end{figure}
This subsystem starts by converting the transmission torque into the force exerted by the tyre onto the road. This is then cross-checked with the tyre friction limit with a `min' statement (as the tyre friction limit cannot be exceeded.) The resistive forces are then summed (cornering force is yet to be modelled) and subtracted from the driving force. We can then calculate vehicle acceleration and velocity (which is looped back into our aerodynamic drag force). 

The track data is also yet to be implemented and will be part of another subsystem, that will take in information such as displacement and output trajectory. The trajectory data will be used within this subsystem to calculate the limits on cornering force and whether the tyres start to slip. 

Currently the motor torque has been modelled as a variable controlled by the user. The motor model being developed will fully simulate a 3-phase BLDC motor using PWM control. Thus, our only input to the system will become the throttle position. A model of the DC motor subsystem is shown below. 
\begin{figure}[H]
	\centering
	\includegraphics[width = \textwidth]{./img/simulink2.png}
	\caption{DC motor model.}
\end{figure}
\section{Results}
As a test, I inputted a simple step command as the motor torque (50 seconds on, 50 seconds off at \SI{5}{\newton\meter}). This yields the following straight line performance of the vehicle.
\begin{figure}[H]
	\centering
	\includegraphics[width = 0.75 \textwidth]{./img/results1.png}
	\caption{Straight Line Performance ($x$ axis - time (s), $y$ axis -velocity (m/s) and torque (Nm)).}
\end{figure}
Currently, the data has not been validated with empirical testing, but this is something I hope to do soon. The true values for the vehicle performance parameters are also to be confirmed, but have been ball-parked using online data and reports from previous years. Once, these are confirmed, the model can be evaluated against empirical data from the current Shell Eco Car. 
\section{Declaration}
\begin{quote}
	\textit{I, Hasha Dar, confirm that the work presented in this report is my own. Where information has been derived from	other sources, I confirm that this has been indicated in the report.}
\end{quote}
\bibliographystyle{agsm}
\bibliography{./bib/export}

%----------------------------------------------------------------------------------------

\end{document}
